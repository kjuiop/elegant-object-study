### 정리

---

- Null일 수 도 있는 객체는 신뢰할 수 없다.
    - 반환된 객체가 Null인지 확인부터 해야하기 때문에, 객체에게 작업을 요청한 후 안심하고 결과에 의지할 수 없다.
- 신뢰의 부족은 결과적으로 낮은 유지보수성으로 이어진다.
    - 코드를 읽을 때 신뢰할 수 있는 메서드 호출이 어떤 것이고 Null을 반환하는 메서드 호출이 어떤 것인지를 이해하기 위해 더 많은 시간이 필요하다.
    - 반환된 객체를 실제로 사용하거나 메세지를 전송하기 전에 이 결과가 NULL이 아닌지를 중복으로 체크야한다.

- 왜 NULL을 반환하는 코드가 흔하고 널리 사용되는 것일까?
    - JDK를 설계하던 시점에 설계자들이 빠르게 실패하기 원칙을 몰랐기 때문
    - 찾는 것이 없을 때 예외를 던지는 것보다는 NULL을 반환해서 사용자가 필요에 따라 예외를 던질 수 있도록 하는 방식이 더 좋은 설계라고 생각했던 것으로 추측
- 빠르게 실패하기 vs 안전하게 실패하기
    - 안전하게 실패하기
        - 버그, 입출력문제, 메모리 오버플로우 등이 발생한 상황에서도 소프트웨어가 계속 실행될 수 있도록 최대한 많은 노력을 기울일 것을 권장한다.
        - NULL을 반환하는 방법도 일종의 생존기법
    - 빠르게 실패하기
        - 일단 문제가 발생하면 곧바로 실행을 중단하고 최대한 빠르게 예외를 던진다.
        - 단위테스트에서 실패상황을 쉽게 재현할 수 있으므로 문제를 간단하게 수정할 수 있다.
        - 프로덕션 환경에서 실패한다고 해도 실패지점이 명확하게 문서화 되어있으므로 상황을 재생하는 테스트를 쉽게 추가할 수 있다.
        - 실패를 눈에 잘 띄게 만들고 추적하기 쉽게한다.
    - 빠르게 실패하기는 실패를 분명하게 만든다. 더 빠르게 문제를 찾을수록 더 빠르게 실패하고 결과적으로 전체적인 품질이 향상되며, 안전성과 견고함을 얻을 수 있다.
- NULL의 대안
    
    ```java
    public User user(String name) {
    	if (/* 데이터베이스에서 발견하지 못했다면 */) {
    		return null;	
    }
    return /* 데이터베이스로부터 */
    }
    ```
    
    - 메서드를 두 개로 나누는 방법
        - 첫번째 메서드는 객체의 존재를 확인하고, 두 번째 메서드는 객체를 반환한다.
        
        ```java
        public boolean exists(String name) {
        	if(/* 데이터베이스에서 발견하지 못했다면 */) {
        	return false
        } 
        return true
        } 
        
        public User user(String name) {
        	return /* 데이터베이스로부터 */
        }
        ```
        
    - Null을 반환하거나 예외를 던지는 대신 객체 컬랙션을 반환하는 방법
        - 사용자를 발견하지 못한 경우 빈 컬렉션 반환
        - 기술적으로는 NULL과 크게 다르지 않지만 더 깔끔?하다
        
        ```java
        public Collection<User> users(String name) {
        	if (/* 데이터베이스에서 발견하지 못했다면 */) {
        		return new ArrayList<>(0);
        	}
        	return Collections.singleton(/* 데이터베이스로부터 */)
        }
        ```
        
        - Optional은 컬렉션과 동일하지만, 하나의 요소만 포함가능하다.
        - 이 방법은 의미론적으로는 부정확하기 때문에 OOP와 대립하며 줜장하지 않는다.
    - null object 디자인 패턴
        - 널 객체 패턴에서는 원하는 객체를 발견하지 못할 경우, 겉으로 보기에는 원래의 객체처럼 보이지만 실제로는 다르게 행동하는 객체를 반환한다.
        - Null 객체는 일부 작업은 정상적으로 처리하지만, 나머지 작업은 처리하지 않는다.
        
        ```java
        class NullUser implements User {
        	private final String label;
        	NullUser(String name) {
        		this.label = name;
        	}
        
        	@Override
        	public String name() {
        		return this.label;
        	}
        
        	@Override
        	public void raise(Cash salary) {
        		throw new IllegalStateException(
        		"exception"
        	)
        	}
        }
        ```
        
- 절대 NULL을 반환하지 마세요. 찾지못한 뭔가를 반환할 필요가 있다면 NULL대신 예외를 던지거나 컬렉션을 반환하거나 널 객체를 반환하세요.

### 느낀점

---

저자의 의견에 적극 동의합니다. 항상 의식적으로 Null 반환을 하지 않도록 노력해야겠다. <br> 하지만 빈 컬렉션과 Optional의 다른점은 잘 모르겠다. 단일 조회인 경우는 Optional을 쓰겠습니다!
